(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{2766:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(4206)}])},4206:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return i}});var a=s(4246),l=s(7378);function n(e){var t;let{supabase:s}=e,[n,r]=(0,l.useState)("dashboard"),[i,c]=(0,l.useState)(null),[o,d]=(0,l.useState)(!0),[u,m]=(0,l.useState)(null),[x,h]=(0,l.useState)([]),[g,f]=(0,l.useState)([]),[b,p]=(0,l.useState)([]),[j,v]=(0,l.useState)(""),[N,w]=(0,l.useState)(""),[y,_]=(0,l.useState)(!1);(0,l.useEffect)(()=>{s.auth.getSession().then(e=>{var t;let{data:{session:s}}=e;c(null!==(t=null==s?void 0:s.user)&&void 0!==t?t:null),d(!1),(null==s?void 0:s.user)&&S(s.user.id)});let{data:{subscription:e}}=s.auth.onAuthStateChange((e,t)=>{var s;c(null!==(s=null==t?void 0:t.user)&&void 0!==s?s:null),(null==t?void 0:t.user)&&S(t.user.id)});return()=>e.unsubscribe()},[]);let S=async e=>{try{let{data:t}=await s.from("client_users").select("client_id, clients(*)").eq("user_id",e).single();if(t){m(t.clients);let{data:e}=await s.from("automations").select("*").eq("client_id",t.client_id);h(e||[]);let{data:a}=await s.from("leads").select("*").eq("client_id",t.client_id).order("created_at",{ascending:!1});f(a||[]);let{data:l}=await s.from("metrics").select("*").eq("client_id",t.client_id);p(l||[])}}catch(e){console.error("Error loading client data:",e)}},I=async()=>{let{error:e}=await s.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/api/auth/callback")}});e&&console.error("Error signing in:",e)},C=async()=>{let{error:e}=await s.auth.signOut();e&&console.error("Error signing out:",e)};if(o)return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-gradient-to-r from-teal-500 to-blue-600 rounded-lg flex items-center justify-center mb-4 mx-auto",children:(0,a.jsx)("span",{className:"text-white font-bold text-lg",children:"BF"})}),(0,a.jsx)("p",{className:"text-gray-600",children:"Loading your portal..."})]})});let k=async e=>{e.preventDefault();let{error:t}=await s.auth.signInWithPassword({email:j,password:N});t&&alert(t.message)},E=async e=>{e.preventDefault();let{error:t}=await s.auth.signUp({email:j,password:N});t?alert(t.message):alert("Check your email for the confirmation link!")};if(!i)return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-lg text-center max-w-md",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-gradient-to-r from-teal-500 to-blue-600 rounded-lg flex items-center justify-center mb-4 mx-auto",children:(0,a.jsx)("span",{className:"text-white font-bold text-lg",children:"BF"})}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Branded + Flow"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"Client Portal Access"}),(0,a.jsx)("button",{onClick:I,className:"w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors mb-4",children:"Sign In with Google"}),(0,a.jsxs)("div",{className:"relative my-4",children:[(0,a.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,a.jsx)("div",{className:"w-full border-t border-gray-300"})}),(0,a.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,a.jsx)("span",{className:"px-2 bg-white text-gray-500",children:"Or"})})]}),(0,a.jsxs)("form",{onSubmit:y?E:k,children:[(0,a.jsx)("input",{type:"email",placeholder:"Email",value:j,onChange:e=>v(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg mb-3 focus:outline-none focus:border-blue-500",required:!0}),(0,a.jsx)("input",{type:"password",placeholder:"Password",value:N,onChange:e=>w(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:border-blue-500",required:!0}),(0,a.jsxs)("button",{type:"submit",className:"w-full bg-teal-600 text-white px-6 py-3 rounded-lg hover:bg-teal-700 transition-colors",children:[y?"Sign Up":"Sign In"," with Email"]})]}),(0,a.jsxs)("p",{className:"mt-4 text-sm text-gray-600",children:[y?"Already have an account?":"Don't have an account?",(0,a.jsx)("button",{onClick:()=>_(!y),className:"ml-1 text-blue-600 hover:underline",children:y?"Sign In":"Sign Up"})]})]})});let B={automations:{active:x.filter(e=>"active"===e.status).length,totalRuns:x.reduce((e,t)=>e+(t.total_runs||0),0),successRate:x.length>0?(x.reduce((e,t)=>e+(t.successful_runs||0),0)/x.reduce((e,t)=>e+(t.total_runs||1),1)*100).toFixed(1):0},leads:{total:g.length,thisWeek:g.filter(e=>{let t=new Date(e.created_at),s=new Date;return s.setDate(s.getDate()-7),t>s}).length,qualified:g.filter(e=>"qualified"===e.status).length,converted:g.filter(e=>"converted"===e.status).length},crm:{contacts:(null===(t=b.find(e=>"crm_contacts"===e.metric_type))||void 0===t?void 0:t.value)||0}};return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("nav",{className:"bg-white shadow-sm",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-gradient-to-r from-teal-500 to-blue-600 rounded-lg flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-white font-bold text-sm",children:"BF"})}),(0,a.jsx)("span",{className:"text-xl font-bold text-gray-800",children:"Branded + Flow"}),u&&(0,a.jsx)("span",{className:"text-sm text-gray-500",children:u.company_name})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(Bell,{className:"w-5 h-5 text-gray-600"}),(0,a.jsx)("button",{onClick:C,className:"text-sm text-gray-600 hover:text-gray-900",children:"Sign Out"})]})]})})}),(0,a.jsx)("main",{className:"max-w-7xl mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[(0,a.jsxs)("h1",{className:"text-2xl font-bold text-gray-800 mb-4",children:["Welcome to your portal",u?", ".concat(u.company_name):"","!"]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"bg-teal-50 p-4 rounded-lg",children:[(0,a.jsx)("h3",{className:"font-semibold text-teal-800",children:"Active Automations"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-teal-600",children:B.automations.active})]}),(0,a.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,a.jsx)("h3",{className:"font-semibold text-blue-800",children:"Total Leads"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:B.leads.total})]}),(0,a.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,a.jsx)("h3",{className:"font-semibold text-green-800",children:"CRM Contacts"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-green-600",children:B.crm.contacts})]})]})]})})]})}let r=(0,s(2409).eI)("https://mezpmegvgeskhdckjfpa.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1lenBtZWd2Z2Vza2hkY2tqZnBhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwNDY3NzcsImV4cCI6MjA3MjYyMjc3N30.ZB4Zp_8cgZSrzIcH7TPqZ8KfDSTlfvT0OyHfpt0BWWU");function i(){return(0,a.jsx)(n,{supabase:r})}}},function(e){e.O(0,[409,888,774,179],function(){return e(e.s=2766)}),_N_E=e.O()}]);